
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String @id
  password      String
  name          String
  isAdmin       Boolean? @default(false)
  isReset       Boolean? @default(true)

  permissions   RepositoryPermissionMap[] 
}

model Device {
  name            String @id
  model           String?
  rawFilePath     String
  repositoryId    Int?

  ips             DeviceIpMap[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now())
}

model DeviceIpMap {
  id        Int @id @default(autoincrement())
  ip        String
  deviceId  String
  device    Device @relation(fields: [deviceId], references: [name])
}

model Repository {
  id        Int @id @default(autoincrement())
  name      String
  desc      String
  parentId  Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  permissions RepositoryPermissionMap[]

  parent      Repository?  @relation("RepositoryToRepository", fields: [parentId], references: [id])
  children    Repository[] @relation("RepositoryToRepository")
}

model RepositoryPermissionMap {
  id            Int @id @default(autoincrement())
  repositoryId  Int
  userId        String
  permission    String

  repository Repository @relation(fields: [repositoryId], references: [id])
  user       User       @relation(fields: [userId],       references: [id])
}

model Logs {
  id            Int @id @default(autoincrement())

}